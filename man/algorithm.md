## 自動生成アルゴリズム概要

詳細はここには書ききれませんが、おおよそ次のような方針で生成アルゴリズムを設計しました。

1. フロー処理のブロック化
    + フロー処理をラベル・条件分岐・ジャンプごとに切り分けてブロック化する
2. ブロック内部の構造を仮決定
    + 命令の数と種類から、ブロック内部の構造と長さ・幅を仮で決める。
    + 各ブロックに出入口を設ける。
      + インタプリタは入口からブロックに入り、ブロック内の処理を実行したのち、出口を通ってブロックから出る。
      + 入口は各ブロック1つ、出口は各ブロック0～2つ（制御構造によって変化）。


1. ブロックのグループ分け
    + 4グループに分割。画像のどの「辺」に配置されるかが決まる。
    + ブロックの長さの合計が均等になるように分ける（→細長くなりにくい）。

1. ブロックの配置と通路配置
    + ブロックを画像の四辺に沿って配置する。
      + 出入口は画像中央に向ける。つまり、インタプリタが画像中央から入って、画像中央に戻るようにする。
    + 出入口の正面に、インタプリタのとおる「通路」を配置する。
      + 通路同士が重なると、うまく遷移しないことがあるため、次のように配置を決める
        + 平行な通路と重なる場合は、配置済みの通路を含め平行移動して、重ならないように再配置する。
          + 再配置によって配置済みブロックの出入口同士の位置関係が崩れるなら、ブロック内部の構造も変更する。
        + 直交する通路とはいくらでも重なってよい。



1. 通路同士の接続
    + 処理フロー通りにブロック間をインタプリタが移動するよう、通路上に「右折」「左折」のためのブロックを配置する。
      + 移動前のブロックの出口通路と、移動後のブロックの入り口通路が直交しているかしていないかで処理が変わる。
        + 直交：交差点に右左折のブロックを置く。
        + 平行：2つの通路を橋渡しする新しい通路を追加し、それらの交点に右左折のブロックを置く。


1. 構造完成。出力する。





細かい点で気にすべき点はもっとたくさんありますが、かなり端折って書けば上記のような感じです。


