## 自動生成アルゴリズム概要

詳細はここには書ききれませんが、おおよそ次のような方針で生成アルゴリズムを設計しました。

+ 用語
  + BLOCK : 処理フローの一部を実行するためのCodelのかたまり。
  + PATH  : 処理フローに沿ってBLOCKの間を移動するための経路。
  + JOINT : PATHの交差点に置かれる、インタプリタの「右折」「左折」を制御するためのCodelのかたまり。
  

1. 処理フローの分割
    + 処理フローをラベル・条件分岐・ジャンプごとにBLOCKに切り分ける。
2. BLOCK内部の構造を仮決定
    + 命令の数と種類から、BLOCK内部の構造と長さ・幅を仮で決める。
    + 各BLOCKに出入口を設ける。
      + インタプリタは入口からBLOCKに入り、BLOCK内の処理を実行したのち、出口を通ってBLOCKから出る。
      + 入口は各BLOCKに1つ、出口は各BLOCKに0～2つ（制御構造によって変化）。


1. BLOCKのグループ分け
    + 4グループに分割。画像のどの「辺」に配置されるかが決まる。
    + BLOCKの長さの合計が均等になるように分ける（→細長くなりにくい）。

1. BLOCKの配置とPATH配置
    + BLOCKを画像の四辺に沿って配置する。
      + 出入口は画像中央に向ける。つまり、インタプリタが画像中央から入って、画像中央に戻るようにする。
    + 出入口の正面に、インタプリタのとおる「PATH」を配置する。
      + PATH同士が重なると、うまく遷移しないことがあるため、次のように配置を決める
        + 平行なPATHと重なる場合は、配置済みのPATHを含め平行移動して、重ならないように再配置する。
          + 再配置によって配置済みBLOCKの出入口同士の位置関係が崩れるなら、BLOCK内部の構造も変更する。
        + 直交するPATHとはいくらでも重なってよい。



1. PATH同士の接続
    + 処理フロー通りにBLOCK間をインタプリタが移動するよう、PATH上に「右折」「左折」のためのJOINTを配置する。
      + 移動前のBLOCKの出口PATHと、移動後のBLOCKの入口PATHが、直交しているかしていないかで処理が変わる。
        + 直交：交差点に右左折のJOINTを置く。
        + 平行：2つのPATHを橋渡しする新しいPATHを追加し、それらの交点に右左折のJOINTを置く。


1. 構造完成。出力する。





細かい点で気にすべき点はもっとたくさんありますが、かなり端折って書けば上記のような感じです。


